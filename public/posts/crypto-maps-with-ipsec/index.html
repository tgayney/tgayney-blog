<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Crypto Maps with IPsec :: Terminal</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="IPsec with Crypto Maps provides a method for securing IP communication between networks through encryption and authentication commonly referred to as site-to-site. ISAKMP (Internet Security Association and Key Management Protocol) establishes the IKE Phase 1 tunnel used to authenticate peers and negotiate the parameters for further communication. Crypto Maps act as the policy framework that binds IPsec/IKE Phase 2 settings such as peers, transform sets, and access lists to a physical (sub)interface. When traffic matches the defined crypto ACL, it is encrypted according to the transform set and sent to the specified peer through an IPsec tunnel.
" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="/posts/crypto-maps-with-ipsec/" />





  
  <link rel="stylesheet" href="/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css">

  
  <link rel="stylesheet" href="/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css">

  
  <link rel="stylesheet" href="/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css">

  
  <link rel="stylesheet" href="/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css">

  
  <link rel="stylesheet" href="/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css">

  
  <link rel="stylesheet" href="/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css">

  
  <link rel="stylesheet" href="/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css">

  
  <link rel="stylesheet" href="/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css">

  
  <link rel="stylesheet" href="/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css">

  
  <link rel="stylesheet" href="/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css">

  
  <link rel="stylesheet" href="/css/terminal.min.c7873912ac7c0556a135f48add411ddd7900a8dad51e1ef66e7fa5c434686224.css">

  
  <link rel="stylesheet" href="/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="shortcut icon" href="/favicon.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Crypto Maps with IPsec">
<meta property="og:description" content="IPsec with Crypto Maps provides a method for securing IP communication between networks through encryption and authentication commonly referred to as site-to-site. ISAKMP (Internet Security Association and Key Management Protocol) establishes the IKE Phase 1 tunnel used to authenticate peers and negotiate the parameters for further communication. Crypto Maps act as the policy framework that binds IPsec/IKE Phase 2 settings such as peers, transform sets, and access lists to a physical (sub)interface. When traffic matches the defined crypto ACL, it is encrypted according to the transform set and sent to the specified peer through an IPsec tunnel.
" />
<meta property="og:url" content="/posts/crypto-maps-with-ipsec/" />
<meta property="og:site_name" content="Terminal" />

  <meta property="og:image" content="/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2025-11-05 12:00:00 -0500 EST" />












</head>
<body>


<div class="container">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Terminal
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/labs">Labs</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/about" >About</a></li>
        
      
        
          <li><a href="/labs" >Labs</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="/posts/crypto-maps-with-ipsec/">Crypto Maps with IPsec</a>
  </h1>
  <div class="post-meta"><time class="post-date">2025-11-05</time></div>

  
  


  

  <div class="post-content"><div>
        <p><strong>IPsec with Crypto Maps</strong> provides a method for securing IP communication between networks through encryption and authentication commonly referred to as site-to-site. <strong>ISAKMP (Internet Security Association and Key Management Protocol)</strong> establishes the <strong>IKE Phase 1 tunnel</strong> used to authenticate peers and negotiate the parameters for further communication. Crypto Maps act as the policy framework that binds <strong>IPsec/IKE Phase 2</strong> settings such as peers, transform sets, and access lists to a physical (sub)interface. When traffic matches the defined crypto ACL, it is encrypted according to the transform set and sent to the specified peer through an IPsec tunnel.</p>
<p>This approach enables administrators to selectively protect traffic, maintain flexible security policies, and ensure confidentiality and integrity across untrusted networks. By combining ISAKMP/IKE for key exchange with Crypto Maps for policy enforcement, IPsec delivers a robust and standards-based foundation for secure site-to-site connectivity.</p>
<h4 id="configuring-crypto-maps-with-ipsec">Configuring Crypto Maps With IPsec<a href="#configuring-crypto-maps-with-ipsec" class="hanchor" ariaLabel="Anchor">#</a> </h4>
<h5 id="configuring-the-isakmp-policy-that-is-ike-phase-1">Configuring The ISAKMP Policy That Is IKE Phase 1<a href="#configuring-the-isakmp-policy-that-is-ike-phase-1" class="hanchor" ariaLabel="Anchor">#</a> </h5>
<p>Before we can begin configuring <strong>crypto maps</strong>, we must first define the four key parameters that make up the <strong>ISAKMP (IKE Phase 1) policy</strong>:</p>
<ul>
<li><strong>Encryption</strong></li>
<li><strong>Hashing</strong></li>
<li><strong>Authentication</strong></li>
<li><strong>Diffie–Hellman Group</strong></li>
</ul>
<p>While higher bit-length encryption and stronger algorithms generally provide better security, they also introduce greater processing overhead. When selecting these parameters, it’s important to strike a balance between <strong>security, performance, and compatibility</strong>. Configuring the most secure ISAKMP policy is possible, but we must also consider whether our VPN peers support the chosen algorithms and whether our device’s CPU can sustain the cryptographic load especially as the number of IPsec tunnels increases.</p>
<p>For this lab we only be configuring one ISAKMP policy but in a real world environment multiple policies would be configured to match the parameters of initiator&rsquo;s/peer&rsquo;s proposal of IKE Phase 1. We will run AES 192 and sha256 across the <strong>Control Plane</strong> then select pre-shared key &ldquo;cisco123&rdquo; because running the alternative being PKI would require additional configuration outside the scope of this post. Finally we will set DH group to 14:</p>
<pre tabindex="0"><code class="language-IOSv" data-lang="IOSv">R1(config)#crypto isakmp policy 10
R1(config-isakmp)# encryption aes 192
R1(config-isakmp)# hash sha256
R1(config-isakmp)# authentication pre-share
R1(config-isakmp)# group 14
!
R1(config)# crypto isakmp key cisco123 address 2.2.2.2
</code></pre><h5 id="configuring-ipsec-transform-set-and-crypto-map-that-make-up-ike-phase-2">Configuring IPsec Transform-Set and Crypto Map That Make Up IKE Phase 2<a href="#configuring-ipsec-transform-set-and-crypto-map-that-make-up-ike-phase-2" class="hanchor" ariaLabel="Anchor">#</a> </h5>
<p>Before we&rsquo;re able to proceed we must configure our <strong>Transform-Set</strong> this will specify the encryption algorithm and hashing in our <strong>Data Plane</strong>, additional the mode of our encapsulation being <strong>Tunnel</strong> vs <strong>Transport</strong> by default encapsulation will operate in Tunnel mode so we will leave alone.
(Control Plane and Data Plane encryption algorithms do not have to match but ISAKMP &amp; IPsec policies must match between peers)</p>
<ul>
<li>Encryption</li>
<li>Hashing</li>
<li>Encapsulation Mode</li>
</ul>
<p>After the preceding has been accomplished we will configure an <strong>Extended ACL</strong> to specify what source traffic should be encrypted to a destination:</p>
<pre tabindex="0"><code class="language-IOSv" data-lang="IOSv">R1(config)# crypto ipsec transform-set TS_NAME esp-aes 192 esp-sha-hmac 
!
R1(config)# ip access-list extended IPSEC_ACL
R1(config-ext-nacl)#10 permit ip 10.1.1.0 0.0.0.255 10.2.5.0 0.0.0.255
</code></pre><h5 id="defining-the-crypto-map">Defining The Crypto Map<a href="#defining-the-crypto-map" class="hanchor" ariaLabel="Anchor">#</a> </h5>
<p>The other options available here include GETVPN and manual keying which doesn&rsquo;t scale well, we will select <code>ipsec-isakmp</code>. Here we will define the Crypto map to use the previously created <strong>Transform-Set</strong> and encrypt traffic specified by our Extended ACL.</p>
<p>For path redundancy we will also configure the tunnel source as our loopback</p>
<p>Finally we apply our previously created Crypto Map to any given physical (sub)interface egress of our peer:</p>
<pre tabindex="0"><code>R1(config)#crypto map CM_NAME 10 ipsec-isakmp 
R1(config-crypto-map)#set transform-set TS_NAME
R1(config-crypto-map)#set peer 2.2.2.2
R1(config-crypto-map)#match address IPSEC_ACL
!
R1(config)# crypto map CM_NAME local-address loopback0
!
R1(config-if)# crypto map CM_NAME
</code></pre><p>Lab: <a href="/downloads/ipsec_with_cryptomap.tar">here</a></p>
<p>sha256sum:</p>

      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Read other posts</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="/posts/an-overview-of-ipsec/" class="button inline prev">
        &lt; [<span class="button__text">An Overview of IPsec</span>]
      </a>
    
    
      ::
    
    
      <a href="/posts/lisp-draft/" class="button inline next">
         [<span class="button__text">LISP Fundamentals</span>] &gt;
      </a>
    
  </div>
</div>


  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
